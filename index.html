<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Smart Inventory Manager Pro</title>
    <style>
        body { font-family: 'Segoe UI', sans-serif; background: #f0f2f5; padding: 10px; margin: 0; display: flex; justify-content: center; }
        .container { width: 100%; max-width: 650px; background: white; padding: 15px; border-radius: 15px; box-shadow: 0 5px 15px rgba(0,0,0,0.1); box-sizing: border-box; position: relative; }
        h2 { text-align: center; color: #1a73e8; margin-top: 5px; }
        
        /* Admin Header */
        .admin-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; background: #f8f9fa; padding: 10px; border-radius: 10px; border: 1px solid #eee; }
        #adminStatus { font-size: 12px; font-weight: bold; color: #555; }
        #loginBtn { padding: 6px 15px; border-radius: 6px; border: none; color: white; cursor: pointer; font-size: 12px; font-weight: bold; }

        /* Admin Section */
        #adminSection { display: none; margin-bottom: 20px; }
        .input-group { background: #f8f9fa; padding: 15px; border-radius: 10px; border: 1px solid #eef0f2; display: flex; flex-direction: column; gap: 10px; }
        .row { display: flex; gap: 10px; width: 100%; }
        input, select { padding: 12px; border: 1px solid #ddd; border-radius: 8px; font-size: 14px; box-sizing: border-box; background: white; width: 100%; }
        
        .btn-row { display: grid; grid-template-columns: repeat(3, 1fr); gap: 8px; margin: 10px 0; }
        button { padding: 10px; border: none; border-radius: 8px; cursor: pointer; font-weight: bold; color: white; font-size: 13px; }
        #addBtn { background: #28a745; width: 100%; }
        #exportBtn { background: #007bff; }
        #printBtn { background: #6c757d; }
        #clearBtn { background: #dc3545; display: none; }

        /* Summary Dashboard */
        .summary-card { background: #1a73e8; color: white; padding: 15px; border-radius: 10px; margin-top: 15px; display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }
        .summary-item { text-align: center; }
        .summary-val { display: block; font-size: 1.2rem; font-weight: bold; }

        #searchInput { margin: 10px 0; border: 2px solid #eef0f2; width: 100%; box-sizing: border-box; padding: 12px; border-radius: 8px; }

        /* Table */
        .table-wrapper { width: 100%; overflow-x: auto; }
        table { width: 100%; border-collapse: collapse; margin-top: 5px; min-width: 400px; }
        th, td { padding: 10px; text-align: left; border-bottom: 1px solid #eee; vertical-align: middle; }
        
        .product-img { width: 60px; height: 60px; object-fit: cover; border-radius: 8px; background: #eee; cursor: pointer; }
        .price-tag { font-weight: bold; color: #28a745; white-space: nowrap; font-size: 1.1rem; }
        .status-badge { font-size: 9px; padding: 2px 5px; border-radius: 4px; color: white; font-weight: bold; }
        .in-stock { background: #28a745; }
        .out-stock { background: #dc3545; }
        
        /* Floating Basket */
        #basketFloat { position: fixed; bottom: 25px; right: 25px; background: #28a745; color: white; width: 60px; height: 60px; border-radius: 50%; display: none; justify-content: center; align-items: center; font-size: 24px; box-shadow: 0 4px 15px rgba(0,0,0,0.3); cursor: pointer; z-index: 999; }
        #basketCount { position: absolute; top: 0; right: 0; background: red; color: white; font-size: 12px; width: 22px; height: 22px; border-radius: 50%; display: flex; justify-content: center; align-items: center; font-weight: bold; border: 2px solid white; }

        /* Modals */
        .modal { display: none; position: fixed; z-index: 2000; left: 0; top: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.6); justify-content: center; align-items: center; padding: 15px; }
        .modal-content { background: white; width: 100%; max-width: 450px; border-radius: 15px; padding: 20px; box-sizing: border-box; position: relative; }
        .basket-item { display: flex; justify-content: space-between; padding: 8px 0; border-bottom: 1px solid #eee; font-size: 14px; }
        .delete-btn { color: #dc3545; font-size: 20px; border: none; background: none; cursor: pointer; }

        @media print { .no-print { display: none !important; } }
    </style>
</head>
<body>

<div class="container">
    <h2>Treat Cheezy Pricelist</h2>

    <div class="admin-header no-print">
        <span id="adminStatus">Mode: View Only</span>
        <button id="loginBtn" onclick="toggleAdmin()" style="background:#444;">Admin Login</button>
    </div>

    <div id="adminSection" class="no-print">
        <div class="input-group">
            <input type="text" id="itemName" placeholder="Item Name">
            <div class="row">
                <input type="text" id="itemQty" placeholder="Unit (e.g. Box)">
                <input type="number" id="itemPrice" placeholder="Retail Price">
            </div>
            <div class="row">
                <select id="itemStatus">
                    <option value="In Stock">In Stock</option>
                    <option value="Out of Stock">Out of Stock</option>
                </select>
                <input type="date" id="itemExpiry">
            </div>
            <input type="text" id="itemImageLink" placeholder="Paste Imgur Link (e.g. https://i.imgur.com/abc.jpg)">
            <button id="addBtn" onclick="alert('Kopyahin ang detalye at i-update ang products.json sa GitHub.')">+ Add Product (Admin Only)</button>
        </div>
    </div>

    <div class="no-print">
        <div class="btn-row">
            <button id="exportBtn" onclick="exportToExcel()">Excel</button>
            <button id="printBtn" onclick="window.print()">Print</button>
            <button id="clearBtn" onclick="clearAllData()">Clear All</button>
        </div>
        <input type="text" id="searchInput" onkeyup="searchFunction()" placeholder="Maghanap ng produkto...">
    </div>

    <div class="summary-card">
        <div class="summary-item"><span>Total Items</span><span class="summary-val" id="totalItems">0</span></div>
        <div class="summary-item"><span>Total Value</span><span class="summary-val" id="totalValue">â‚±0</span></div>
    </div>

    <div class="table-wrapper">
        <table>
            <thead>
                <tr>
                    <th>Photo</th>
                    <th>Details</th>
                    <th>Price</th>
                    <th class="no-print">Action</th>
                </tr>
            </thead>
            <tbody id="productBody"></tbody>
        </table>
    </div>
</div>

<div id="basketFloat" onclick="toggleBasketModal()">
    ðŸ›’ <span id="basketCount">0</span>
</div>

<div id="basketModal" class="modal" onclick="toggleBasketModal()">
    <div class="modal-content" onclick="event.stopPropagation()">
        <h3 style="margin-top:0; color:#1a73e8;">ðŸ›’ Ang Iyong Basket</h3>
        <div style="display: flex; flex-direction: column; gap: 8px; margin-bottom: 15px;">
            <input type="text" id="customerName" placeholder="Pangalan (Required)">
            <input type="number" id="customerContact" placeholder="Contact No (Required)">
            <input type="number" id="customerGcash" placeholder="GCash No (Optional)">
        </div>
        <div id="basketList" style="max-height: 200px; overflow-y: auto; margin-bottom:15px; border-top: 1px solid #eee;"></div>
        <div style="border-top: 2px solid #1a73e8; padding-top:10px;">
            <div style="display:flex; justify-content:space-between; font-weight:bold; font-size:1.1rem; margin-bottom:10px;">
                <span>TOTAL:</span>
                <span id="basketTotal">â‚±0</span>
            </div>
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px;">
                <button onclick="sendOrder('whatsapp')" style="background:#28a745; padding:12px;">WhatsApp</button>
                <button onclick="sendOrder('messenger')" style="background:#0084ff; padding:12px;">Messenger</button>
            </div>
            <button onclick="toggleBasketModal()" style="background:#6c757d; width:100%; margin-top:10px;">Isara</button>
        </div>
    </div>
</div>

<script>
    let isAdmin = false;
    let basket = [];
    let currentLiveItems = [];

    // CONFIGURATION
    const ADMIN_PHONE = "639153290207"; // Palitan mo ng number mo
    const FB_USERNAME = "kram.samot.2024"; // Palitan mo ng FB username mo
    const JSON_URL = 'products.json'; 

    document.addEventListener('DOMContentLoaded', () => {
        if (localStorage.getItem('adminLoggedIn') === 'true') {
            isAdmin = true;
            applyAdminUI();
        }
        loadData();
    });

    async function loadData() {
        try {
            const res = await fetch(JSON_URL + '?nocache=' + new Date().getTime());
            currentLiveItems = await res.json();
            displayItems(currentLiveItems);
        } catch (e) {
            document.getElementById('productBody').innerHTML = "<tr><td colspan='4' style='text-align:center;'>Wala pang data. I-upload ang products.json.</td></tr>";
        }
    }

    function displayItems(items) {
        let tableBody = document.getElementById('productBody');
        let totalVal = 0;
        tableBody.innerHTML = '';

        items.forEach((item, index) => {
            totalVal += Number(item.price);
            let statusClass = item.status === "In Stock" ? "in-stock" : "out-stock";
            // Check if image is URL or placeholder
            let img = item.image || 'https://via.placeholder.com/60';

            tableBody.innerHTML += `
                <tr>
                    <td><img src="${img}" class="product-img" onerror="this.src='https://via.placeholder.com/60?text=Error'"></td>
                    <td>
                        <strong>${item.name}</strong><br>
                        <span class="status-badge ${statusClass}">${item.status}</span><br>
                        <small style="color:#666">${item.qty || ''}</small>
                        ${item.expiry ? `<br><small style="color:red">EXP: ${item.expiry}</small>` : ''}
                    </td>
                    <td class="price-tag">â‚±${Number(item.price).toLocaleString()}</td>
                    <td class="no-print">
                        ${isAdmin ? 
                            `<button class="delete-btn" onclick="alert('I-edit ang products.json sa GitHub.')">&times;</button>` : 
                            `<button onclick="addToBasket('${item.name}', ${item.price})" style="background:#1a73e8; padding:8px; font-size:11px;">+ Basket</button>`
                        }
                    </td>
                </tr>
            `;
        });
        document.getElementById('totalItems').innerText = items.length;
        document.getElementById('totalValue').innerText = "â‚±" + totalVal.toLocaleString();
    }

    // Basket Logic
    function addToBasket(name, price) {
        basket.push({ name, price });
        updateBasketUI();
        document.getElementById('basketFloat').style.display = 'flex';
    }

    function updateBasketUI() {
        document.getElementById('basketCount').innerText = basket.length;
        let list = document.getElementById('basketList');
        let total = 0;
        list.innerHTML = basket.map((item, i) => {
            total += item.price;
            return `<div class="basket-item">
                <span>${item.name}</span>
                <span>â‚±${item.price.toLocaleString()} <button onclick="removeFromBasket(${i})" class="delete-btn" style="font-size:16px;">&times;</button></span>
            </div>`;
        }).join('');
        document.getElementById('basketTotal').innerText = "â‚±" + total.toLocaleString();
    }

    function removeFromBasket(i) {
        basket.splice(i, 1);
        updateBasketUI();
        if(basket.length === 0) {
            document.getElementById('basketFloat').style.display = 'none';
            toggleBasketModal();
        }
    }

    function toggleBasketModal() {
        const modal = document.getElementById('basketModal');
        modal.style.display = (modal.style.display === 'flex') ? 'none' : 'flex';
    }

    function sendOrder(platform) {
        const name = document.getElementById('customerName').value;
        const contact = document.getElementById('customerContact').value;
        const gcash = document.getElementById('customerGcash').value;
        if(!name || !contact) return alert("Paki-puno ang Pangalan at Contact No.");
        
        let msg = `*BAGONG ORDER MULA SA WEBSITE*\n`;
        msg += `ðŸ‘¤ Customer: ${name.toUpperCase()}\n`;
        msg += `ðŸ“ž Contact: ${contact}\n`;
        if(gcash) msg += `ðŸ’° GCash: ${gcash}\n`;
        msg += `----------------------------\n`;
        let total = 0;
        basket.forEach(item => {
            msg += `- ${item.name} (â‚±${item.price.toLocaleString()})\n`;
            total += item.price;
        });
        msg += `\n*TOTAL: â‚±${total.toLocaleString()}*`;

        if(platform === 'whatsapp') {
            window.open(`https://wa.me/${ADMIN_PHONE}?text=${encodeURIComponent(msg)}`, '_blank');
        } else {
            navigator.clipboard.writeText(msg).then(() => {
                alert("Order details copied! I-paste sa Messenger chat.");
                window.open(`https://m.me/${FB_USERNAME}`, '_blank');
            });
        }
    }

    // Admin
    function toggleAdmin() {
        if (!isAdmin) {
            let pass = prompt("Enter Admin Password:");
            if (pass === "123") {
                isAdmin = true;
                localStorage.setItem('adminLoggedIn', 'true');
                applyAdminUI();
                location.reload();
            }
        } else {
            localStorage.removeItem('adminLoggedIn');
            location.reload();
        }
    }

    function applyAdminUI() {
        document.getElementById('adminSection').style.display = "block";
        document.getElementById('adminStatus').innerText = "Mode: Admin (Logged In)";
        document.getElementById('loginBtn').innerText = "Logout";
        document.getElementById('loginBtn').style.background = "#dc3545";
        document.getElementById('clearBtn').style.display = "block";
    }

    function searchFunction() {
        let input = document.getElementById('searchInput').value.toUpperCase();
        let rows = document.getElementById('productBody').getElementsByTagName('tr');
        for (let row of rows) {
            row.style.display = row.textContent.toUpperCase().includes(input) ? "" : "none";
        }
    }

    function exportToExcel() {
        let csv = "Item,Price,Status\n";
        currentLiveItems.forEach(i => csv += `"${i.name}",${i.price},"${i.status}"\n`);
        let link = document.createElement("a");
        link.href = 'data:text/csv;charset=utf-8,' + encodeURI(csv);
        link.download = "inventory.csv";
        link.click();
    }

    function clearAllData() {
        if(confirm("Burahin lahat sa GitHub?")) {
            window.open('https://github.com', '_blank');
        }
    }
</script>
</body>
  </html>

